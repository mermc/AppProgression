
<div class="estadisticas-container" #exportContainer>
  <div class="stats-layout">
    <!-- IZQUIERDA: panel de ítems -->
    <aside class="items-panel" aria-label="Seleccionar ítems a combinar">
      <h4>Seleccionar ítems a combinar</h4>
      <div class="items-controls">
        <button class="app-btn btn-secondary select-all" (click)="toggleSelectAll()">
    <mat-icon>done_all</mat-icon>
    {{ selectedItemIds.length === allItems.length ? 'Restablecer' : 'Seleccionar todo' }}
  </button>
      </div>
      <ul class="items-list">
        <li *ngFor="let it of allItems" class="items-list-item">
          <label>
            <input type="checkbox" [checked]="selectedItemIds.includes(it.id)" (change)="toggleItem(it)" />
            <span class="color-dot" [style.background]="itemsInfo[it.id]?.color || '#3f51b5'"></span>
            <span class="item-desc">{{ itemsInfo[it.id]?.descripcion || it.descripcion }}</span>
          </label>
        </li>
      </ul>
    </aside>

    <!-- Derecha: Graficas y controles -->
    <main class="stats-main">
      <header class="stats-header">
        <h2 class="stats-title">Estadísticas del ítem: {{ itemNombre }}</h2>

        <div class="stats-controls">
          <div class="months-toggle" role="tablist" aria-label="Seleccionar periodo">
            <button *ngFor="let m of monthsOptions"
                    (click)="changeMonths(m)"
                    [class.active]="monthsToShow === m"
                    class="months-button"
                    [attr.aria-pressed]="monthsToShow === m">
              Últimos {{ m }}
            </button>
          </div>

          <div class="stats-meta">
            <div class="percent-change">
              <span class="label">Último mes:</span>
              <span class="value">{{ lastPercentChangeText }}</span>
            </div>
            <div class="months-info">Mostrando últimos {{ monthsToShow }} meses</div>
          </div>
        </div>
      </header>

      <div class="chart-card">
        <canvas #chartCanvas></canvas>
      </div>

      <div class="caption" *ngIf="autogeneratedCaption">{{ autogeneratedCaption }}</div>

      <div class="stats-actions">
        <button (click)="descargarJPEG()" mat-raised-button class="app-btn btn-primary">
        <mat-icon>download</mat-icon> Descargar JPEG</button>

        <button (click)="volver()" mat-stroked-button class="app-btn btn-secondary">
        <mat-icon>arrow_back</mat-icon> Volver </button>
      </div>
    </main>
  </div>
</div>